-- Marker Teleport Script for Roblox with Millisecond Delay
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local guiParent = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MarkerTeleportUI"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = guiParent

-- Main Frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 360, 0, 450)
frame.Position = UDim2.new(0.3, 0, 0.3, 0)
frame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -30, 0, 30)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
title.Text = "Marker Teleport Panel"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 18
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = frame

-- Close Button
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -30, 0, 0)
closeBtn.Text = "X"
closeBtn.BackgroundColor3 = Color3.fromRGB(100, 50, 50)
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 18
closeBtn.Parent = frame

-- Floating Reopen Button
local reopenBtn = Instance.new("TextButton")
reopenBtn.Size = UDim2.new(0, 40, 0, 40)
reopenBtn.Position = UDim2.new(0.85, 0, 0.8, 0)
reopenBtn.Text = "â˜°"
reopenBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
reopenBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
reopenBtn.Font = Enum.Font.SourceSansBold
reopenBtn.TextSize = 24
reopenBtn.Parent = screenGui
reopenBtn.Visible = false
reopenBtn.AutoButtonColor = true

-- Draggable floating icon logic
local dragging = false
local dragInput, mousePos, framePos
reopenBtn.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		mousePos = input.Position
		framePos = reopenBtn.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then dragging = false end
		end)
	end
end)
reopenBtn.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)
UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		local delta = input.Position - mousePos
		reopenBtn.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X,
										framePos.Y.Scale, framePos.Y.Offset + delta.Y)
	end
end)
reopenBtn.MouseButton1Click:Connect(function()
	frame.Visible = true
	reopenBtn.Visible = false
end)
closeBtn.MouseButton1Click:Connect(function()
	frame.Visible = false
	reopenBtn.Visible = true
end)

-- Content Frame
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, -10, 1, -35)
contentFrame.Position = UDim2.new(0, 5, 0, 35)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = frame

-- Variables
local totalSlots = 4
local markers = {
	Vector3.new(-4655.0, 258.0, -1925.0),
	Vector3.new(-4322.0, 258.0, -2287.0),
	Vector3.new(-4307.0, 257.9, -1926.0),
	Vector3.new(-4660.0, 257.9, -2287.0)
}
local selectedSlot = 1
local delayTime = 2000 -- Default to 2000ms (2 seconds)
local loopActive = false
local currentLoopIndex = 1

-- Slot Label
local slotLabel = Instance.new("TextLabel")
slotLabel.Size = UDim2.new(0.9,0,0,40)
slotLabel.Position = UDim2.new(0.05,0,0.02,0)
slotLabel.BackgroundColor3 = Color3.fromRGB(40,40,40)
slotLabel.TextColor3 = Color3.fromRGB(255,255,255)
slotLabel.Font = Enum.Font.SourceSansBold
slotLabel.TextSize = 14
slotLabel.Text = string.format("Selected Slot: %d\nX: %.1f Y: %.1f Z: %.1f", 
	selectedSlot, markers[selectedSlot].X, markers[selectedSlot].Y, markers[selectedSlot].Z)
slotLabel.Parent = contentFrame

-- Coord Input Box
local coordBox = Instance.new("TextBox")
coordBox.Size = UDim2.new(0.9,0,0,25)
coordBox.Position = UDim2.new(0.05,0,0.15,0)
coordBox.PlaceholderText = "Type coords: X,Y,Z"
coordBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
coordBox.TextColor3 = Color3.fromRGB(255,255,255)
coordBox.ClearTextOnFocus = false
coordBox.Font = Enum.Font.SourceSans
coordBox.TextSize = 14
coordBox.Parent = contentFrame

-- Slot Selection Buttons
local slotButtons = {}
for i = 1, totalSlots do
	local slotBtn = Instance.new("TextButton")
	slotBtn.Size = UDim2.new(0.2, -5, 0, 25)
	slotBtn.Position = UDim2.new(0.05 + (i-1)*0.23, 0, 0.25, 0)
	slotBtn.Text = "Slot "..i
	slotBtn.BackgroundColor3 = Color3.fromRGB(70,70,100)
	slotBtn.TextColor3 = Color3.fromRGB(255,255,255)
	slotBtn.Font = Enum.Font.SourceSans
	slotBtn.TextSize = 14
	slotBtn.Parent = contentFrame
	
	if i == selectedSlot then
		slotBtn.BackgroundColor3 = Color3.fromRGB(100,200,100)
	end
	
	slotBtn.MouseButton1Click:Connect(function()
		selectedSlot = i
		for _, btn in pairs(slotButtons) do
			btn.BackgroundColor3 = Color3.fromRGB(70,70,100)
		end
		slotBtn.BackgroundColor3 = Color3.fromRGB(100,200,100)
		local pos = markers[selectedSlot]
		if pos then
			slotLabel.Text = string.format("Selected Slot: %d\nX: %.1f Y: %.1f Z: %.1f", selectedSlot, pos.X, pos.Y, pos.Z)
		else
			slotLabel.Text = string.format("Selected Slot: %d\nNo coordinates set", selectedSlot)
		end
	end)
	
	table.insert(slotButtons, slotBtn)
end

-- Save/Paste Button
local saveBtn = Instance.new("TextButton")
saveBtn.Size = UDim2.new(0.9,0,0,35)
saveBtn.Position = UDim2.new(0.05,0,0.35,0)
saveBtn.Text = "Save / Paste Coord"
saveBtn.BackgroundColor3 = Color3.fromRGB(80,80,140)
saveBtn.TextColor3 = Color3.fromRGB(255,255,255)
saveBtn.Font = Enum.Font.SourceSansBold
saveBtn.TextSize = 14
saveBtn.Parent = contentFrame
saveBtn.MouseButton1Click:Connect(function()
	if selectedSlot then
		if coordBox.Text and coordBox.Text ~= "" then
			local x,y,z = coordBox.Text:match("([^,]+),%s*([^,]+),%s*([^,]+)")
			if x and y and z then
				markers[selectedSlot] = Vector3.new(tonumber(x), tonumber(y), tonumber(z))
			end
		else
			local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
			if hrp then
				markers[selectedSlot] = hrp.Position
			end
		end
		local pos = markers[selectedSlot]
		slotLabel.Text = string.format("Selected Slot: %d\nX: %.1f Y: %.1f Z: %.1f", selectedSlot, pos.X, pos.Y, pos.Z)
	end
end)

-- Teleport Button
local teleportBtn = Instance.new("TextButton")
teleportBtn.Size = UDim2.new(0.9,0,0,35)
teleportBtn.Position = UDim2.new(0.05,0,0.45,0)
teleportBtn.Text = "Teleport to Selected Slot"
teleportBtn.BackgroundColor3 = Color3.fromRGB(80,140,80)
teleportBtn.TextColor3 = Color3.fromRGB(255,255,255)
teleportBtn.Font = Enum.Font.SourceSansBold
teleportBtn.TextSize = 14
teleportBtn.Parent = contentFrame
teleportBtn.MouseButton1Click:Connect(function()
	if selectedSlot and markers[selectedSlot] then
		local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
		if hrp then
			hrp.CFrame = CFrame.new(markers[selectedSlot])
		end
	end
end)

-- Delay Input Section
local delayLabel = Instance.new("TextLabel")
delayLabel.Size = UDim2.new(0.4,0,0,25)
delayLabel.Position = UDim2.new(0.05,0,0.58,0)
delayLabel.BackgroundColor3 = Color3.fromRGB(40,40,40)
delayLabel.TextColor3 = Color3.fromRGB(255,255,255)
delayLabel.Font = Enum.Font.SourceSansBold
delayLabel.TextSize = 14
delayLabel.Text = "Delay (ms):"
delayLabel.Parent = contentFrame

-- Delay Input Box
local delayBox = Instance.new("TextBox")
delayBox.Size = UDim2.new(0.5,0,0,25)
delayBox.Position = UDim2.new(0.45,0,0.58,0)
delayBox.Text = tostring(delayTime)
delayBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
delayBox.TextColor3 = Color3.fromRGB(255,255,255)
delayBox.ClearTextOnFocus = false
delayBox.Font = Enum.Font.SourceSans
delayBox.TextSize = 14
delayBox.Parent = contentFrame

-- Function to validate and update delay time
local function updateDelayTime()
	local newDelay = tonumber(delayBox.Text)
	if newDelay and newDelay >= 0 then
		delayTime = newDelay
	else
		delayBox.Text = tostring(delayTime)
	end
end

delayBox.FocusLost:Connect(function(enterPressed)
	updateDelayTime()
end)

-- Loop Teleport Button
local loopBtn = Instance.new("TextButton")
loopBtn.Size = UDim2.new(0.9,0,0,35)
loopBtn.Position = UDim2.new(0.05,0,0.68,0)
loopBtn.Text = "Start Loop"
loopBtn.BackgroundColor3 = Color3.fromRGB(80,120,80)
loopBtn.TextColor3 = Color3.fromRGB(255,255,255)
loopBtn.Font = Enum.Font.SourceSansBold
loopBtn.TextSize = 16
loopBtn.Parent = contentFrame

loopBtn.MouseButton1Click:Connect(function()
	-- Update delay time from input box
	updateDelayTime()
	
	loopActive = not loopActive
	loopBtn.Text = loopActive and "Stop Loop" or "Start Loop"

	-- Set visibility
	local function setVisibility(invisible)
		local character = player.Character
		if character then
			for _, part in pairs(character:GetDescendants()) do
				if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
					part.Transparency = invisible and 1 or 0
				elseif part:IsA("Decal") or part:IsA("Texture") then
					part.Transparency = invisible and 1 or 0
				end
			end
		end
	end
	setVisibility(loopActive)

	if loopActive then
		task.spawn(function()
			while loopActive do
				local found = false
				for i = 1,totalSlots do
					currentLoopIndex = currentLoopIndex > totalSlots and 1 or currentLoopIndex
					if markers[currentLoopIndex] then
						local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
						if hrp then
							hrp.CFrame = CFrame.new(markers[currentLoopIndex])
						end
						found = true
						currentLoopIndex = currentLoopIndex +1
						break
					end
					currentLoopIndex = currentLoopIndex +1
				end
				if not found then break end
				-- Use milliseconds for delay
				task.wait(delayTime / 1000)
			end
			-- Revert visibility
			setVisibility(false)
		end)
	end
end)

-- Reset Button
local resetBtn = Instance.new("TextButton")
resetBtn.Size = UDim2.new(0.9,0,0,35)
resetBtn.Position = UDim2.new(0.05,0,0.78,0)
resetBtn.Text = "Reset All Slots"
resetBtn.BackgroundColor3 = Color3.fromRGB(140,80,80)
resetBtn.TextColor3 = Color3.fromRGB(255,255,255)
resetBtn.Font = Enum.Font.SourceSansBold
resetBtn.TextSize = 16
resetBtn.Parent = contentFrame
resetBtn.MouseButton1Click:Connect(function()
	for i=1,totalSlots do
		markers[i] = nil
	end
	slotLabel.Text = "Selected Slot: None"
end)

-- Instructions Label
local instructions = Instance.new("TextLabel")
instructions.Size = UDim2.new(0.9,0,0,80)
instructions.Position = UDim2.new(0.05,0,0.88,0)
instructions.BackgroundColor3 = Color3.fromRGB(40,40,40)
instructions.TextColor3 = Color3.fromRGB(200,200,255)
instructions.Font = Enum.Font.SourceSans
instructions.TextSize = 12
instructions.TextXAlignment = Enum.TextXAlignment.Left
instructions.TextYAlignment = Enum.TextYAlignment.Top
instructions.Text = "Instructions: Enter coords as X,Y,Z or save current position. Select a slot, then teleport or start a loop. Delay is in milliseconds (1000ms = 1s)."
instructions.Parent = contentFrame
