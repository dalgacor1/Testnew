-- ðŸª© Looper (Draggable Panel + Slot Popup attached + Close Button)

-- Services
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local guiParent = game:GetService("CoreGui")

-- ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MarkerTeleportUI"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = guiParent

-- Main Frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 420, 0, 450)
frame.Position = UDim2.new(0.3, 0, 0.3, 0)
frame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -30, 0, 30) -- leave space for close button
title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
title.Text = "Marker Teleport Panel"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 18
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = frame

-- Close Button (X)
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -30, 0, 0)
closeBtn.Text = "X"
closeBtn.BackgroundColor3 = Color3.fromRGB(100, 50, 50)
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 18
closeBtn.Parent = frame

closeBtn.MouseButton1Click:Connect(function()
    frame.Visible = false
end)

-- Content Holder
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, -10, 1, -40)
contentFrame.Position = UDim2.new(0, 5, 0, 35)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = frame

-- Variables
local markers = {}
local slotButtons = {}
local delayTime = 2
local loopActive = false
local currentLoopIndex = 1

-- Create Slot Buttons
for i = 1, 5 do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.3, -5, 0, 40)
    btn.Position = UDim2.new(((i - 1) % 3) * 0.33, 0, math.floor((i - 1) / 3) * 0.25, 0)
    btn.Text = "Slot " .. i .. "\n[Empty]"
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSans
    btn.TextWrapped = true
    btn.TextScaled = true

    local sizeConstraint = Instance.new("UITextSizeConstraint")
    sizeConstraint.MinTextSize = 12
    sizeConstraint.MaxTextSize = 18
    sizeConstraint.Parent = btn

    btn.Parent = contentFrame
    slotButtons[i] = btn

    btn.MouseButton1Click:Connect(function()
        local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end

        if markers[i] then
            -- Teleport
            hrp.CFrame = markers[i]
        else
            -- Create marker at current pos
            markers[i] = hrp.CFrame
            local pos = hrp.Position
            local posStr = string.format("%.1f, %.1f, %.1f", pos.X, pos.Y, pos.Z)
            btn.Text = "Slot " .. i .. "\n" .. posStr
            btn.BackgroundColor3 = Color3.fromRGB(100, 150, 100)
        end
    end)
end

-- Delay Label
local delayLabel = Instance.new("TextLabel")
delayLabel.Size = UDim2.new(0.6, 0, 0, 30)
delayLabel.Position = UDim2.new(0, 0, 0.55, 0)
delayLabel.Text = "Delay: " .. delayTime .. "s"
delayLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
delayLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
delayLabel.Font = Enum.Font.SourceSansBold
delayLabel.TextSize = 16
delayLabel.Parent = contentFrame

-- Delay Controls
local plusBtn = Instance.new("TextButton")
plusBtn.Size = UDim2.new(0.2, -5, 0, 30)
plusBtn.Position = UDim2.new(0.6, 5, 0.55, 0)
plusBtn.Text = "+"
plusBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 120)
plusBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
plusBtn.Parent = contentFrame

local minusBtn = Instance.new("TextButton")
minusBtn.Size = UDim2.new(0.2, -5, 0, 30)
minusBtn.Position = UDim2.new(0.8, 5, 0.55, 0)
minusBtn.Text = "-"
minusBtn.BackgroundColor3 = Color3.fromRGB(120, 80, 80)
minusBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minusBtn.Parent = contentFrame

plusBtn.MouseButton1Click:Connect(function()
    delayTime = delayTime + 1
    delayLabel.Text = "Delay: " .. delayTime .. "s"
end)
minusBtn.MouseButton1Click:Connect(function()
    if delayTime > 1 then
        delayTime = delayTime - 1
        delayLabel.Text = "Delay: " .. delayTime .. "s"
    end
end)

-- Loop Toggle Button
local loopBtn = Instance.new("TextButton")
loopBtn.Size = UDim2.new(0.45, -5, 0, 40)
loopBtn.Position = UDim2.new(0, 0, 0.65, 0)
loopBtn.Text = "Start Loop"
loopBtn.BackgroundColor3 = Color3.fromRGB(80, 120, 80)
loopBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
loopBtn.Font = Enum.Font.SourceSansBold
loopBtn.TextSize = 16
loopBtn.Parent = contentFrame

loopBtn.MouseButton1Click:Connect(function()
    loopActive = not loopActive
    loopBtn.Text = loopActive and "Stop Loop" or "Start Loop"
    if loopActive then
        task.spawn(function()
            while loopActive do
                if markers[currentLoopIndex] then
                    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        hrp.CFrame = markers[currentLoopIndex]
                    end
                end
                currentLoopIndex = currentLoopIndex % 5 + 1
                task.wait(delayTime)
            end
        end)
    end
end)

-- Reset Button
local resetBtn = Instance.new("TextButton")
resetBtn.Size = UDim2.new(0.45, -5, 0, 40)
resetBtn.Position = UDim2.new(0.55, 0, 0.65, 0)
resetBtn.Text = "Reset"
resetBtn.BackgroundColor3 = Color3.fromRGB(120, 80, 80)
resetBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
resetBtn.Font = Enum.Font.SourceSansBold
resetBtn.TextSize = 16
resetBtn.Parent = contentFrame

resetBtn.MouseButton1Click:Connect(function()
    markers = {}
    for i, btn in ipairs(slotButtons) do
        btn.Text = "Slot " .. i .. "\n[Empty]"
        btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    end
    loopActive = false
    loopBtn.Text = "Start Loop"
end)

-- Copy Coords Button
local copyBtn = Instance.new("TextButton")
copyBtn.Size = UDim2.new(0.45, -5, 0, 30)
copyBtn.Position = UDim2.new(0, 0, 0.75, 0)
copyBtn.Text = "Copy Coords"
copyBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 120)
copyBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
copyBtn.Parent = contentFrame

copyBtn.MouseButton1Click:Connect(function()
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if hrp then
        local pos = hrp.Position
        local posStr = string.format("%.1f, %.1f, %.1f", pos.X, pos.Y, pos.Z)
        if setclipboard then
            setclipboard(posStr)
        elseif toclipboard then
            toclipboard(posStr)
        end
    end
end)

-- Paste Box
local pasteBox = Instance.new("TextBox")
pasteBox.Size = UDim2.new(0.45, -5, 0, 30)
pasteBox.Position = UDim2.new(0.55, 0, 0.75, 0)
pasteBox.PlaceholderText = "Paste coords (X, Y, Z)"
pasteBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
pasteBox.TextColor3 = Color3.fromRGB(255, 255, 255)
pasteBox.ClearTextOnFocus = false
pasteBox.Parent = contentFrame

-- Paste to Slot Button
local pasteBtn = Instance.new("TextButton")
pasteBtn.Size = UDim2.new(0.9, 0, 0, 30)
pasteBtn.Position = UDim2.new(0.05, 0, 0.85, 0)
pasteBtn.Text = "Paste to Slot"
pasteBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 160)
pasteBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
pasteBtn.Parent = contentFrame

-- Slot Picker Popup (attached to panel)
local slotPopup = Instance.new("Frame")
slotPopup.Size = UDim2.new(0.9, 0, 0, 150)
slotPopup.Position = UDim2.new(0.05, 0, 1, 0) -- just below paste button
slotPopup.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
slotPopup.Visible = false
slotPopup.Parent = frame

local popupTitle = Instance.new("TextLabel")
popupTitle.Size = UDim2.new(1, 0, 0, 30)
popupTitle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
popupTitle.Text = "Choose Slot"
popupTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
popupTitle.Font = Enum.Font.SourceSansBold
popupTitle.TextSize = 16
popupTitle.Parent = slotPopup

for i = 1, 5 do
    local sbtn = Instance.new("TextButton")
    sbtn.Size = UDim2.new(0.9, 0, 0, 20)
    sbtn.Position = UDim2.new(0.05, 0, (i * 0.18), 0)
    sbtn.Text = "Slot " .. i
    sbtn.BackgroundColor3 = Color3.fromRGB(70, 70, 100)
    sbtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    sbtn.Parent = slotPopup

    sbtn.MouseButton1Click:Connect(function()
        if pasteBox.Text and pasteBox.Text ~= "" then
            local x, y, z = pasteBox.Text:match("([^,]+),%s*([^,]+),%s*([^,]+)")
            if x and y and z then
                local pos = Vector3.new(tonumber(x), tonumber(y), tonumber(z))
                markers[i] = CFrame.new(pos)
                slotButtons[i].Text = "Slot " .. i .. "\n" .. string.format("%.1f, %.1f, %.1f", pos.X, pos.Y, pos.Z)
                slotButtons[i].BackgroundColor3 = Color3.fromRGB(100, 150, 100)
            end
        end
        slotPopup.Visible = false
    end)
end

pasteBtn.MouseButton1Click:Connect(function()
    slotPopup.Visible = not slotPopup.Visible
end)

print("âœ… Marker Teleport Panel Loaded (Draggable + Popup attached + Close Button)")
